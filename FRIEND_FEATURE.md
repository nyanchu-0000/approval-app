# フレンド追加機能

## 概要

1人のフレンドのみを追加できる機能を実装しました。お互いがフレンドIDを入力して追加し合った時に初めてフレンド関係が成立します。

## 主な機能

### 1. ユーザーID自動生成
- アプリ初回起動時に、各ユーザーに固有の8文字のIDが自動生成されます
- IDは大文字英数字からなるランダムな文字列です（例: `A7B3K9X2`）

### 2. フレンド追加フロー

#### ステップ1: 自分のIDを相手に共有
- プロフィール画面または「フレンドを追加」画面で自分のIDを確認
- 相手にIDを教える（LINEやメールなどで共有）

#### ステップ2: 相手のIDを入力
- 「フレンドを追加」画面で相手のIDを入力
- 「フレンドを追加」ボタンをクリック

#### ステップ3: フレンド関係の成立
- 相手も同様にあなたのIDを入力すると、自動的にフレンド関係が成立
- 成立後、お互いの投稿が「承認一覧」に表示されるようになります

### 3. フレンドリクエストの状態管理

以下の3つの状態があります：

1. **リクエスト未送信**: まだ誰にもリクエストを送っていない状態
2. **リクエスト送信済み**: 相手のIDを入力済み、相手の応答待ち
3. **フレンド成立**: お互いが追加し合い、フレンド関係が成立

### 4. 制限事項

- **1人のみ**: 同時に複数のフレンドを持つことはできません
- **相互追加必須**: 片方だけの追加では不十分で、お互いが追加する必要があります
- **自分自身は追加不可**: 自分のIDを入力してもエラーになります

## 画面構成

### AddFriendPage（フレンド追加画面）
- `/add-friend`
- 自分のIDの表示
- フレンドIDの入力フォーム
- リクエスト状態の表示
- リクエストのキャンセル機能

### ProfilePage（プロフィール画面）
- `/profile`
- 自分のIDの表示（小さく表示）
- フレンド情報の表示
- フレンド追加ボタン（未追加時）
- フレンド解除ボタン（追加済み時）

### ApprovalListPage（承認一覧画面）
- `/approvals`
- フレンドがいない場合は専用メッセージを表示
- フレンドの投稿のみを表示
- 承認ボタンで「いいね」が可能

## データ構造

### User型（更新後）
```typescript
interface User {
  uid: string;                      // ユーザーID
  username: string;                 // ユーザー名
  email: string;                    // メールアドレス
  profileIcon: string;              // プロフィールアイコン
  friendId: string | null;          // フレンドのUID（null = フレンドなし）
  friendRequestTo: string | null;   // リクエスト送信先のUID
  friendRequestFrom: string | null; // リクエスト送信元のUID
  createdAt: Date;
  updatedAt: Date;
}
```

### FriendStatus型（新規）
```typescript
interface FriendStatus {
  hasFriend: boolean;
  friendId: string | null;
  friendProfile: UserProfile | null;
  pendingRequest: boolean;
  requestDirection: 'sent' | 'received' | null;
}
```

## LocalStorageのデータ

以下のキーでデータを保存しています：

- `currentUser`: 現在のユーザー情報（User型）
- `allUsers`: 全ユーザーの配列（User[]）
- `posts`: 全ての投稿の配列

## 使い方

1. アプリを起動（自動的にユーザーIDが生成されます）
2. プロフィール画面で「フレンドを追加」をクリック
3. 自分のIDを相手に教える
4. 相手のIDを入力して「フレンドを追加」をクリック
5. 相手も同様に操作するとフレンド成立
6. 「承認一覧」で相手の投稿が表示されます

## 今後の改善案

- Firebase連携時の実装
- QRコードでのID共有機能
- フレンド申請の通知機能
- フレンド解除の確認ダイアログ改善


